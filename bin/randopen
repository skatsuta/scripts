#!/usr/bin/env python3

import random
import re
import subprocess
import sys
from pathlib import Path
from typing import List

CONTENT_REGEX = re.compile(r'\.(zip|rar|mp4|avi|mkv|wmv|flv|m4v|rmvb)$', flags=re.IGNORECASE)


def main() -> None:
    # Base directory
    base_dir = Path(sys.argv[1])

    # List all files in the base directory recursively
    files = [str(f) for f in base_dir.rglob('*') if f.is_file()]
    print(f'Total number of files: {len(files)}')

    # Select a single file among them
    selected_file = select_file(files)
    print(f'Selected: {selected_file}')

    # Open the selected file
    subprocess.run(['open', selected_file])


def select_file(files: List[str]) -> str:
    selected = random.choice(files)
    if CONTENT_REGEX.search(selected):
        return selected

    print(f'{selected} is not a content file; selecting again...')
    return select_file(files)


if __name__ == '__main__':
    main()
