#!/usr/bin/env python3

import glob
import os
import random
import re
import subprocess
import sys
from typing import List

CONTENT_REGEX = re.compile(r'\.(zip|rar|mp4|avi|mkv|wmv|flv|m4v|rmvb)$', flags=re.IGNORECASE)


def list_files(base_dir: str) -> List[str]:
    return [
        f for f in glob.glob(os.path.join(base_dir, '**/*'), recursive=True)
        if not os.path.isdir(f)
    ]


def select_file(files: List[str]) -> str:
    selected = random.choice(files)
    if CONTENT_REGEX.search(selected):
        return selected

    print(f'{selected} is not a content file; selecting again...')
    return select_file(files)


def main():
    base_dir = sys.argv[1]
    files = list_files(base_dir)
    selected_file = select_file(files)
    print(f'Selected: {selected_file}')
    subprocess.run(['open', selected_file])


if __name__ == '__main__':
    main()
